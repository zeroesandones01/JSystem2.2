<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptCSEPNoticeOfAward" pageWidth="612" pageHeight="792" columnWidth="572" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.1000000000000005"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="285"/>
	<parameter name="subrptNoticeOfAward" class="java.io.InputStream" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="ntp_no" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["000087"]]></defaultValueExpression>
	</parameter>
	<parameter name="prepared_by" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["AAGONZALES"]]></defaultValueExpression>
	</parameter>
	<parameter name="logo" class="java.io.InputStream" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="hasDP" class="java.lang.Boolean" isForPrompting="false"/>
	<queryString>
		<![CDATA[SELECT
a.award_date, a.contract_no, b.entity_name, get_client_address_for2307(a.entity_id) as address, f.contactperson, f.position, c.proj_name, d._count,
to_words(d._count::VARCHAR) AS  _word,
a.orig_contract_price,
UPPER(FORMAT('%s', to_words_v2(a.orig_contract_price))) AS orig_contract_price_word,
a.dp_percentage,
to_words(a.dp_percentage::VARCHAR) as dp_percentage_word,
a.start_date,
a.finish_date,
date_part('day', timestamp_mi(timestamp_pl_interval(a.finish_date, INTERVAL '1 day'), a.start_date))::INT AS working_days,
to_words(date_part('day', timestamp_mi(timestamp_pl_interval(a.finish_date, INTERVAL '1 day'), a.start_date))::VARCHAR) AS  working_days_word,
trim(e.company_name) as company,
(select (select initcap(sub_proj_name) from mf_sub_project where proj_id = a.proj_id and replace(sub_proj_alias, ' ', '') = replace(a.phase, ' ', ''))
	from (select regexp_split_to_table(contract_no, '-') as phase, proj_id
		from co_ntp_header
		where ntp_no = $P{ntp_no}) a
	where a.phase ~* 'PH') as phase,
(select replace(replace(replace((array_agg((other_cost = 4550.0000)::text))::text, '{'::text, ''::text), '}'::text, ''::text), '"'::text, ''::text) from co_ntp_detail WHERE ntp_no = $P{ntp_no}) as isCSEMetering,

/*upper((select replace(replace(replace((array_agg(REPLACE(work_desc, '&', '&#038;')))::text, '{'::text, ''::text), '}'::text, ''::text), '"'::text, ''::text) from co_ntp_detail WHERE ntp_no = '000608'))as title*/

(SELECT work_desc FROM co_ntp_detail where ntp_no = $P{ntp_no} LIMIT 1) as work_items,
(select ntp_subject_description from co_ntp_subjects WHERE ntp_no = a.ntp_no limit 1) as title

FROM co_ntp_header a
LEFT JOIN rf_entity b ON b.entity_id = a.entity_id
LEFT JOIN mf_project c ON c.proj_id = a.proj_id
LEFT JOIN (SELECT count(ntp_no) AS _count, ntp_no FROM co_ntp_detail WHERE ntp_no = $P{ntp_no} GROUP BY ntp_no) d ON d.ntp_no = a.ntp_no
LEFT JOIN mf_company e ON e.co_id = a.co_id
LEFT JOIN rf_contacts f ON f.entity_id = a.entity_id

WHERE a.ntp_no = $P{ntp_no};]]>
	</queryString>
	<field name="award_date" class="java.sql.Timestamp"/>
	<field name="contract_no" class="java.lang.String"/>
	<field name="entity_name" class="java.lang.String"/>
	<field name="address" class="java.lang.String"/>
	<field name="contactperson" class="java.lang.String"/>
	<field name="position" class="java.lang.String"/>
	<field name="proj_name" class="java.lang.String"/>
	<field name="_count" class="java.lang.Long"/>
	<field name="_word" class="java.lang.String"/>
	<field name="orig_contract_price" class="java.math.BigDecimal"/>
	<field name="orig_contract_price_word" class="java.lang.String"/>
	<field name="dp_percentage" class="java.math.BigDecimal"/>
	<field name="dp_percentage_word" class="java.lang.String"/>
	<field name="start_date" class="java.sql.Timestamp"/>
	<field name="finish_date" class="java.sql.Timestamp"/>
	<field name="working_days" class="java.lang.Integer"/>
	<field name="working_days_word" class="java.lang.String"/>
	<field name="company" class="java.lang.String"/>
	<field name="phase" class="java.lang.String"/>
	<field name="iscsemetering" class="java.lang.String"/>
	<field name="work_items" class="java.lang.String"/>
	<field name="title" class="java.lang.String"/>
	<variable name="CURRENT_PAGE_NUMBER" class="java.lang.Integer" resetType="Page">
		<variableExpression><![CDATA[$V{PAGE_NUMBER}]]></variableExpression>
		<initialValueExpression><![CDATA[]]></initialValueExpression>
	</variable>
	<variable name="contract_price" class="java.lang.String">
		<variableExpression><![CDATA[new DecimalFormat("#,##0.00").format($F{orig_contract_price})]]></variableExpression>
	</variable>
	<variable name="start_date" class="java.lang.String">
		<variableExpression><![CDATA[new SimpleDateFormat("MMMMM dd, YYYY").format($F{start_date})]]></variableExpression>
	</variable>
	<title>
		<band height="79" splitType="Stretch">
			<textField>
				<reportElement x="10" y="29" width="550" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="15" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{company}.toUpperCase()]]></textFieldExpression>
			</textField>
			<image hAlign="Center" vAlign="Middle">
				<reportElement x="30" y="15" width="50" height="50"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<imageExpression class="java.io.InputStream"><![CDATA[$P{logo}]]></imageExpression>
			</image>
		</band>
	</title>
	<detail>
		<band height="320" splitType="Stretch">
			<frame>
				<reportElement positionType="Float" x="10" y="70" width="550" height="60"/>
				<staticText>
					<reportElement positionType="Float" x="0" y="0" width="80" height="30"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Tahoma" size="12"/>
					</textElement>
					<text><![CDATA[To:]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="0" width="470" height="30"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{entity_name}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="30" width="470" height="30"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{address}]]></textFieldExpression>
				</textField>
			</frame>
			<frame>
				<reportElement positionType="Float" x="10" y="130" width="550" height="60"/>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="30" width="470" height="30"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{position}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement positionType="Float" x="0" y="0" width="80" height="30"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Tahoma" size="12"/>
					</textElement>
					<text><![CDATA[Attention:]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="0" width="470" height="30"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{contactperson}]]></textFieldExpression>
				</textField>
			</frame>
			<frame>
				<reportElement positionType="Float" x="10" y="190" width="550" height="30"/>
				<staticText>
					<reportElement positionType="Float" x="0" y="0" width="80" height="30"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Tahoma" size="12"/>
					</textElement>
					<text><![CDATA[Subject]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
					<reportElement positionType="Float" x="80" y="0" width="470" height="30"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{proj_name} + " " + ($F{phase} == null ? "":$F{phase}.toUpperCase()) + " SUBDIVISION"]]></textFieldExpression>
				</textField>
			</frame>
			<staticText>
				<reportElement positionType="Float" x="10" y="0" width="80" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="12"/>
				</textElement>
				<text><![CDATA[Date:]]></text>
			</staticText>
			<textField pattern="dd MMMMM yyyy">
				<reportElement positionType="Float" x="90" y="0" width="470" height="30"/>
				<textElement verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{award_date}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="10" y="35" width="80" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="12"/>
				</textElement>
				<text><![CDATA[Ref. No.:]]></text>
			</staticText>
			<textField pattern="">
				<reportElement positionType="Float" x="90" y="35" width="470" height="30"/>
				<textElement verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{contract_no}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="10" y="260" width="169" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Gentlemen:]]></text>
			</staticText>
			<textField isStretchWithOverflow="true">
				<reportElement positionType="Float" x="10" y="290" width="550" height="20"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Justified" markup="styled">
					<font fontName="Tahoma" size="12" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{ntp_no}.equals("000030") || $P{ntp_no}.equals("002289") ? "We refer to our previous negotiation pertaining to the <b>" + $F{work_items} + "</b> at <b>"+ $F{proj_name} + " " + ($F{phase} == null ? "":$F{phase}.toUpperCase()) +"</b> of subject project located in Bgy. Bancal, Municipality of Carmona, in the Province of Cavite and are pleased to inform you of our intent to award you the above mentioned works package." +

"\n\n" +

"The <b>COST OF THE PROJECT</b> shall be <b>Philippine Pesos</b>: <b>"+ $F{orig_contract_price_word} +"</b> (<b>PHP "+ $V{contract_price} +"</b>) which shall be payment for all materials, labor and supervision, tools and equipment, fuels and oils, temporary facilities, profits, VAT and taxes and other incidentals necessary for the proper and immediate execution of the following works, breakdown of which are contained at attached tabulation of quantities, marked as Annex A and made an integral part hereof, to include:" :
"We refer to our previous negotiation pertaining to the <b>" + $F{title} + "</b> at <b>"+ $F{proj_name} + " " + ($F{phase} == null ? "":$F{phase}.toUpperCase()) +"</b> of subject project located in Bgy. Bancal, Municipality of Carmona, in the Province of Cavite and are pleased to inform you of our intent to award you the above mentioned works package." +

"\n\n" +

"The <b>COST OF THE PROJECT</b> shall be <b>Philippine Pesos</b>: <b>"+ $F{orig_contract_price_word} +"</b> (<b>PHP "+ $V{contract_price} +"</b>) which shall be payment for all materials, labor and supervision, tools and equipment, fuels and oils, temporary facilities, profits, VAT and taxes and other incidentals necessary for the proper and immediate execution of the following works, breakdown of which are contained at attached tabulation of quantities, marked as Annex A and made an integral part hereof, to include:"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="">
				<reportElement positionType="Float" x="90" y="220" width="470" height="20"/>
				<textElement verticalAlignment="Middle" markup="styled">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{ntp_no}.equals("002289") ? $F{work_items}:$F{title}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="">
				<reportElement positionType="Float" x="90" y="240" width="470" height="20"/>
				<textElement verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["NOTICE OF AWARD / TO PROCEED"]]></textFieldExpression>
			</textField>
		</band>
		<band height="82" splitType="Stretch">
			<staticText>
				<reportElement positionType="Float" x="20" y="16" width="540" height="13"/>
				<textElement>
					<font fontName="Tahoma"/>
				</textElement>
				<text><![CDATA[Mobilization and Demobilization]]></text>
			</staticText>
			<frame>
				<reportElement positionType="Float" x="20" y="31" width="540" height="13"/>
				<textField isStretchWithOverflow="true">
					<reportElement positionType="Float" x="0" y="0" width="540" height="13"/>
					<box topPadding="0" bottomPadding="0">
						<pen lineWidth="0.0"/>
						<topPen lineWidth="0.0"/>
						<leftPen lineWidth="0.0"/>
						<bottomPen lineWidth="0.0"/>
						<rightPen lineWidth="0.0"/>
					</box>
					<textElement textAlignment="Justified" markup="styled">
						<font fontName="Tahoma" size="10" isBold="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{ntp_no}.equals("000029") || $P{ntp_no}.equals("000067") || $P{ntp_no}.equals("000068")  || $P{ntp_no}.equals("000076") ? "" + $F{title} + " (15 Calendar Days)\n" +
"       Computation of individual lot area of subd on Site Development plan of the project\n" +
"       Preparation of Subdivision plan of the Project in Standard mylar film 15x22 in.\n" +
"       Preparation of lot description of resulting lots, in standard mylar film\n" +
"       Preparation of lot data computations of resulting lots\n" +
"       Preparation of field notes, setting data and other survey returns for submission to the Bureau of lands for\n" +
"         verification & approval\n" +
"       Preparation of lot area summary of the project\n" +
"       Preparation of Project lot plan/Vicinity map\n\n" +
"Supply of Concrete Monuments (Mojon) for all roads and all lots (0.15m diameter & 0.30m ht.)(30 Calendar Days)\n" +
"Supervision during Staking and Monumenting, and Turn-over (one time) - coordinate with CMD" : "<b>" + $F{title}.replace("&", "&amp;") + "</b>"]]></textFieldExpression>
				</textField>
			</frame>
			<subreport runToBottom="false">
				<reportElement positionType="Float" x="74" y="47" width="486" height="13" isRemoveLineWhenBlank="true">
					<printWhenExpression><![CDATA[$P{ntp_no}.equals("002289") == false]]></printWhenExpression>
				</reportElement>
				<subreportParameter name="ntp_no">
					<subreportParameterExpression><![CDATA[$P{ntp_no}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression class="java.io.InputStream"><![CDATA[$P{subrptNoticeOfAward}]]></subreportExpression>
			</subreport>
			<textField>
				<reportElement positionType="Float" x="20" y="63" width="540" height="13"/>
				<textElement markup="styled">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Hauling and disposal of excess materials."]]></textFieldExpression>
			</textField>
		</band>
		<band height="20">
			<textField isStretchWithOverflow="true">
				<reportElement x="10" y="0" width="550" height="20"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Justified" markup="styled">
					<font fontName="Tahoma" size="12" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[($P{hasDP} ? "A <b>down payment equivalent "+ $F{dp_percentage_word} +" percent ("+ $F{dp_percentage} +"%)</b> of above project cost shall be billable upon mobilization of your equipment at site which shall be recouped upon final billing.":"No downpayment required.") +

"Final billing shall be subject to <b>ten percent (10%) retention</b>." +

"\n\n" +

"This will also serve as <b>notice</b> for you to mobilize your men and equipment and commence work on or before <b>"+ $V{start_date} +"</b> and complete above works within <b>"+ $F{working_days_word} +" ("+ $F{working_days} +")</b> Calendar days reckoned from said start date. Failure to complete the Works within the specified time shall be ground for <b>"+ $F{company} +"</b> to impose Liquidated Damages equivalent to one-tenth of one percent (1/10 of 1 %) of the above project cost per day of delay." +

"\n\n\n" +

"We are attaching the following documents (Annexes) embodying details thereof as mutually agreed by us that shall be deemed binding prior to the preparation of a Formal Contract Agreement for above Work Package." +

"\n\n\n" +

"1.0 Tabulation of Quantities Annex A" +

"\n\n\n" +

"We look forward to a harmonious and close association with you in completing the above works on schedule and with your support." +

"\n\n\n\n\n\n\n" +

"Very truly yours," +

"\n\n\n" +

"<b>" + $F{company} + "</b>" +

"\n\n\n\n\n" +

"<b>ATTY. ANGELICA ERNESTINE L. BAROÃ‘A</b>" +

"\n\n" +

"<b>(LLD Head)</b>"]]></textFieldExpression>
			</textField>
		</band>
		<band height="20">
			<textField isStretchWithOverflow="true">
				<reportElement x="257" y="0" width="303" height="20"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement markup="styled">
					<font fontName="Tahoma" size="12" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["\n\n\n<b>Conforme:</b>" +

"\n\n" +

"<b>" + $F{entity_name} + "</b>"+


"\n\n\n\n" +

"<b>" + $F{contactperson} + "</b>\n" +
"<b>" + $F{position} + "</b>"]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="15">
			<textField isStretchWithOverflow="true" evaluationTime="Auto">
				<reportElement positionType="Float" x="422" y="3" width="150" height="12"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="7" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["As of: " + new SimpleDateFormat("EEE MMM dd, yyyy hh:mm a").format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" evaluationTime="Auto">
				<reportElement positionType="Float" x="0" y="3" width="200" height="12"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="7" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["/" + $P{prepared_by}.toUpperCase()]]></textFieldExpression>
			</textField>
			<frame>
				<reportElement x="219" y="3" width="120" height="12"/>
				<textField pattern="" isBlankWhenNull="false">
					<reportElement mode="Transparent" x="0" y="0" width="80" height="12" forecolor="#000000" backcolor="#FFFFFF"/>
					<textElement textAlignment="Right" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="7" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
				</textField>
				<textField evaluationTime="Report" pattern="" isBlankWhenNull="false">
					<reportElement mode="Transparent" x="80" y="0" width="40" height="12" forecolor="#000000" backcolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="7" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</columnFooter>
</jasperReport>
