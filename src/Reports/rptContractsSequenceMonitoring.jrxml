<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptContractsMonitoring" pageWidth="792" pageHeight="612" orientation="Landscape" columnWidth="772" leftMargin="10" rightMargin="10" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.1289478601075555"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="logo" class="java.io.InputStream" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="company" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["CENQHOMES DEVELOPMENT CORPORATION"]]></defaultValueExpression>
	</parameter>
	<parameter name="proj_id" class="java.lang.String">
		<defaultValueExpression><![CDATA["008"]]></defaultValueExpression>
	</parameter>
	<parameter name="proj_name" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["EAST BELLEVEU RESIDENCES"]]></defaultValueExpression>
	</parameter>
	<parameter name="ntp_type_id" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["02"]]></defaultValueExpression>
	</parameter>
	<parameter name="ntp_type_name" class="java.lang.String">
		<defaultValueExpression><![CDATA["HOUSING"]]></defaultValueExpression>
	</parameter>
	<parameter name="ntp_date_from" class="java.util.Date" isForPrompting="false"/>
	<parameter name="ntp_date_to" class="java.util.Date" isForPrompting="false"/>
	<parameter name="prepared_by" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["AAGONZALES"]]></defaultValueExpression>
	</parameter>
	<parameter name="_server" class="java.lang.String" isForPrompting="false"/>
	<parameter name="_dbase" class="java.lang.String" isForPrompting="false"/>
	<parameter name="phase" class="java.lang.String"/>
	<parameter name="co_id" class="java.lang.String"/>
	<queryString>
		<![CDATA[select h.phase,
a.co_id, a.contract_no, b.type_desc,c.entity_name as contractor,
a.start_date, a.finish_date,d.proj_name,/*sum(e.other_cost * e.work_qty)as total_cost*/a.orig_contract_price as total_cost,g.ntp_type_code
from co_ntp_header a
left join mf_ntp_type b on a.ntp_type_id = b.type_id
left join rf_entity c on a.entity_id = c.entity_id
left join mf_project d on a.proj_id = d.proj_id
/*left join co_ntp_detail e on a.ntp_no = e.ntp_no and e.status_id = 'A'
left join mf_unit_info f on e.pbl_id = f.pbl_id and a.proj_id = f.proj_id  and f.status_id = 'A'*/
left join (select ntp_type_id, ntp_type_code from rf_contract_sequence group by ntp_type_id, ntp_type_code) g on a.ntp_type_id = g.ntp_type_id
left join mf_sub_project h on a.proj_id = h.proj_id and a.sub_proj_id = h.sub_proj_id
where
(case when $P{ntp_type_name}= '' then true else type_desc = $P{ntp_type_name} end)
and (case when NULLIF($P{proj_id}, 'null') is null then true else a.proj_id = nullif($P{proj_id}, 'null') end)
and (case when NULLIF($P{co_id}, 'null') is null then true else a.co_id = nullif($P{co_id}, 'null') end)
and a.status_id = 'A'
and
(
	case
		when h.phase is not null and nullif($P{phase}, 'null') is not null
			then (case when nullif($P{phase}, 'null') is null then true else h.phase = nullif($P{phase},'null') end)
		when nullif($P{phase}, 'null') is null
			then replace((case when split_part(a.contract_no, '-', 3) ~* 'PH' then split_part(a.contract_no, '-', 3) else null end), 'PH', '') is null
		else h.phase = nullif($P{phase}, 'null')
	end
)
/*group by h.phase, a.contract_no, b.type_desc,c.entity_name,
a.start_date, a.finish_date,d.proj_name,g.ntp_type_code,a.co_id,f.phase*/
order by b.type_desc,(case when replace(replace(replace(replace(replace(split_part(a.contract_no, '-', 4), g.ntp_type_code, ''), 'T', ''), 'GFC', ''), 'B', ''), 'SR', '') = '' then '0' else
replace(replace(replace(replace(replace(split_part(a.contract_no, '-', 4), g.ntp_type_code, ''), 'T', ''), 'GFC', ''), 'B', ''), 'SR', '') end)::int]]>
	</queryString>
	<field name="phase" class="java.lang.String"/>
	<field name="co_id" class="java.lang.String"/>
	<field name="contract_no" class="java.lang.String"/>
	<field name="type_desc" class="java.lang.String"/>
	<field name="contractor" class="java.lang.String"/>
	<field name="start_date" class="java.sql.Timestamp"/>
	<field name="finish_date" class="java.sql.Timestamp"/>
	<field name="proj_name" class="java.lang.String"/>
	<field name="total_cost" class="java.math.BigDecimal"/>
	<field name="ntp_type_code" class="java.lang.String"/>
	<variable name="CURRENT_PAGE_NUMBER" class="java.lang.Integer" resetType="Page">
		<variableExpression><![CDATA[$V{PAGE_NUMBER}]]></variableExpression>
		<initialValueExpression><![CDATA[]]></initialValueExpression>
	</variable>
	<group name="grpNTP">
		<groupExpression><![CDATA[$F{type_desc}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField>
					<reportElement x="36" y="0" width="687" height="20"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="9" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{type_desc}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="66">
			<textField>
				<reportElement x="1" y="0" width="365" height="15"/>
				<textElement>
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{company}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="1" y="15" width="365" height="10"/>
				<textElement verticalAlignment="Top" markup="none">
					<font fontName="Tahoma" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[String.format("CONTRACTS MONITORING REPORT (%s)", $P{ntp_type_name})]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="1" y="25" width="365" height="10"/>
				<textElement verticalAlignment="Top" markup="none">
					<font fontName="Tahoma" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{proj_name}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="35" width="365" height="10"/>
				<textElement verticalAlignment="Top" markup="none">
					<font fontName="Tahoma" size="8" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[(($P{phase}==null || $P{phase}.equals("null"))?"":String.format("PHASE %s",$P{phase} ))]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="20" splitType="Stretch">
			<staticText>
				<reportElement x="159" y="0" width="161" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[NTP Name]]></text>
			</staticText>
			<staticText>
				<reportElement x="36" y="0" width="123" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Contract No.]]></text>
			</staticText>
			<staticText>
				<reportElement x="320" y="0" width="161" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Contractor]]></text>
			</staticText>
			<staticText>
				<reportElement x="481" y="0" width="100" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Total Cost]]></text>
			</staticText>
			<staticText>
				<reportElement x="581" y="0" width="71" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Start Date]]></text>
			</staticText>
			<staticText>
				<reportElement x="652" y="0" width="71" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[Finish Date]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement x="159" y="0" width="161" height="20"/>
				<box leftPadding="2">
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{type_desc}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="36" y="0" width="123" height="20"/>
				<box leftPadding="2">
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{contract_no}]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yyyy" isBlankWhenNull="true">
				<reportElement x="581" y="0" width="71" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{start_date}]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yyyy" isBlankWhenNull="true">
				<reportElement x="652" y="0" width="71" height="20"/>
				<box>
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{finish_date}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="320" y="0" width="161" height="20"/>
				<box leftPadding="2">
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{contractor}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;-#,##0.00">
				<reportElement x="481" y="0" width="100" height="20"/>
				<box leftPadding="2" rightPadding="2">
					<pen lineWidth="0.25"/>
					<topPen lineWidth="0.25"/>
					<leftPen lineWidth="0.25"/>
					<bottomPen lineWidth="0.25"/>
					<rightPen lineWidth="0.25"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{total_cost}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
