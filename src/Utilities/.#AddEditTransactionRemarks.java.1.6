package Utilities;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Insets;
import java.awt.Window;
import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import javax.swing.BorderFactory;
import javax.swing.Box;
import javax.swing.DefaultListModel;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTabbedPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.ListSelectionModel;
import javax.swing.SwingUtilities;
import javax.swing.SwingWorker;
import javax.swing.table.DefaultTableModel;

import org.jdesktop.swingx.JXTextArea;
import org.jdesktop.swingx.JXTextField;

import Accounting.Collections.CheckStatusMonitoring;
import Database.pgSelect;
import DateChooser._JDateChooser;
import Functions.FncGlobal;
import Functions.FncReport;
import Functions.FncSystem;
import Functions.UserInfo;
import Lookup.LookupEvent;
import Lookup.LookupListener;
import Lookup._JLookup;
import Reports.Accounting.SummaryofDeposits;
import components.JTBorderFactory;
import components._JInternalFrame;
import components._JTableMain;
import components._JXTextField;
import tablemodel.modelTransactionSummary;

public class AddEditTransactionRemarks extends _JInternalFrame {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	static Dimension frameSize = new Dimension(700,600);
	private JPanel pnlMain;
	private JPanel pnlCenter;
	private JLabel lblCompany;
	private _JLookup lookupCompany;
	private JTextField txtCompany;
	private JLabel lblProject;
	private _JLookup lookupProject;
	private JTextField txtProject;
	private JXTextField txtRemarks;
	private JPanel pnlSouth;
	private JButton btnSave;
	private JButton btnCancel;
	private JTabbedPane tabPane;
	private JScrollPane scrollPCOST;
	private modelTransactionSummary modelPCOSTList;
	private _JTableMain tblPCOST;
	private JScrollPane scrollTCOST;
	private modelTransactionSummary modelTCOSTList;
	private _JTableMain tblTCOST;
	private _JXTextField txtSearch;
	private String co_id;
	private String company;
	private String proj_id;
	private String proj_name;
	private JButton btnPreview;
	private JPanel pnlPreview;
	private JButton btnOK;
	private JButton btnClose;
	private _JDateChooser dteDateFrom;
	private _JDateChooser dteDateTo;

	public AddEditTransactionRemarks() {
		super("Add/Edit Remarks", true, true, true, true);
		initGui();

	}

	private void initGui() {
		// TODO Auto-generated method stub
		this.setLayout(new BorderLayout(5,5));
		this.setSize(frameSize);
		this.setMinimumSize(frameSize);
		{
			pnlMain = new JPanel(new BorderLayout(5,5));
			this.add(pnlMain, BorderLayout.CENTER);
			pnlMain.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
			{
				pnlPreview = new JPanel(new BorderLayout(5,5));
				pnlPreview.setPreferredSize(new Dimension(600,80));
				{
					JPanel pnlDate = new JPanel(new GridLayout(1,4,5,5));
					pnlPreview.add(pnlDate, BorderLayout.CENTER);
					{
						JLabel lblDateFrom = new JLabel("Date From:", JLabel.CENTER);
						pnlDate.add(lblDateFrom);
						lblDateFrom.setFont(FncGlobal.sizeLabel);
					}
					{
						dteDateFrom = new _JDateChooser("MM/dd/yyyy", "##/##/##", '_');
						pnlDate.add(dteDateFrom);						
						dteDateFrom.setFont(FncGlobal.sizeTextValue);
						dteDateFrom.setDate(FncGlobal.getDateToday());
					}
					{
						JLabel lblDateTo = new JLabel("Date To:", JLabel.CENTER);
						pnlDate.add(lblDateTo);
						lblDateTo.setFont(FncGlobal.sizeLabel);
					}
					{
						dteDateTo = new _JDateChooser("MM/dd/yyyy", "##/##/##", '_');
						pnlDate.add(dteDateTo);
						dteDateTo.setFont(FncGlobal.sizeTextValue);
						dteDateTo.setDate(FncGlobal.getDateToday());
					}
				}
				{
					JPanel pnlButton = new JPanel(new GridLayout(1,6,5,5));
					pnlPreview.add(pnlButton, BorderLayout.SOUTH);
					pnlButton.setPreferredSize(new Dimension(0,30));
					{
						pnlButton.add(Box.createHorizontalBox());
						pnlButton.add(Box.createHorizontalBox());
					}
					{
						btnOK = new JButton("OK");
						pnlButton.add(btnOK);
						btnOK.setActionCommand("Preview");
						btnOK.addActionListener(this);
						btnOK.setFont(FncGlobal.sizeControls);
					}
					{
						btnClose = new JButton("Cancel");
						pnlButton.add(btnClose);
						btnClose.setActionCommand("Close");
						btnClose.addActionListener(this);
						btnClose.setFont(FncGlobal.sizeControls);
					}
					{
						pnlButton.add(Box.createHorizontalBox());
						pnlButton.add(Box.createHorizontalBox());
					}
				}
			}
			{
				pnlCenter = new JPanel(new GridBagLayout());
				pnlMain.add(pnlCenter, BorderLayout.CENTER);
				{
					GridBagConstraints c = new GridBagConstraints();
					c.fill = GridBagConstraints.BOTH;
					{
						c.weightx = 1;
						c.weighty = 0.25;

						c.gridx = 0;
						c.gridy = 0;

						JPanel pnlCompany = new JPanel(new GridBagLayout());
						pnlCenter.add(pnlCompany, c);
						pnlCompany.setBorder(JTBorderFactory.createTitleBorder("Details"));
						{
							GridBagConstraints cons_com = new GridBagConstraints();
							cons_com.fill = GridBagConstraints.BOTH;
							cons_com.insets = new Insets(5, 5, 5, 5);
							//LINE1
							{
								cons_com.weightx = 0;
								cons_com.weighty = 1;

								cons_com.gridx = 0;
								cons_com.gridy = 0;

								lblCompany = new JLabel("Company", JLabel.CENTER);
								pnlCompany.add(lblCompany, cons_com);
								lblCompany.setFont(FncGlobal.sizeLabel);
							}
							{
								cons_com.weightx = 0.25;
								cons_com.weighty = 1;

								cons_com.gridx = 1;
								cons_com.gridy = 0;

								lookupCompany = new _JLookup(null, "Company");
								pnlCompany.add(lookupCompany, cons_com);
								lookupCompany.setReturnColumn(0);
								lookupCompany.setLookupSQL(SummaryofDeposits.company());
								lookupCompany.setFont(FncGlobal.sizeTextValue);
								//lookupCompany.setPreferredSize(new Dimension(60,0));
								lookupCompany.addLookupListener(new LookupListener() {

									@Override
									public void lookupPerformed(LookupEvent event) {
										// TODO Auto-generated method stub
										Object[] data = ((_JLookup) event.getSource()).getDataSet();

										if(data!=null) {
											co_id = (String) data[0];
											company = (String) data[1];

											lookupProject.setValue(null);
											txtProject.setText("");

											txtCompany.setText(company);
											lookupProject.setLookupSQL(CheckStatusMonitoring.sql_project(co_id));
										}	
									}
								});
							}
							{
								cons_com.weightx = 1;
								cons_com.weighty = 1;

								cons_com.gridx = 2;
								cons_com.gridy = 0;

								txtCompany = new JTextField();
								pnlCompany.add(txtCompany, cons_com);
								txtCompany.setEditable(false);
								txtCompany.setFont(FncGlobal.sizeTextValue);
							}

							//LINE2
							{
								cons_com.weightx = 0;
								cons_com.weighty = 1;

								cons_com.gridx = 0;
								cons_com.gridy = 1;

								lblProject = new JLabel("Project", JLabel.CENTER);
								pnlCompany.add(lblProject, cons_com);
								lblProject.setEnabled(true);
								lblProject.setFont(FncGlobal.sizeLabel);
							}
							{
								cons_com.weightx = 0.25;
								cons_com.weighty = 1;

								cons_com.gridx = 1;
								cons_com.gridy = 1;

								lookupProject = new _JLookup(null, "Project");
								pnlCompany.add(lookupProject, cons_com);
								lookupProject.setReturnColumn(0);
								lookupProject.setFont(FncGlobal.sizeTextValue);
								//lookupProject.setPreferredSize(new Dimension(60,0));
								lookupProject.addLookupListener(new LookupListener() {

									@Override
									public void lookupPerformed(LookupEvent event) {

										Object[] data = ((_JLookup) event.getSource()).getDataSet();

										if(data!=null) {
											proj_id = (String) data[0];		
											proj_name = (String) data[1];

											txtProject.setText(proj_name);
											txtSearch.setEditable(true);

											btnSave.setEnabled(true);
											btnPreview.setEnabled(true);

											displayPCOST(modelPCOSTList, co_id);	
											displayTCOST(modelTCOSTList, co_id);
										}	
									}
								});
							}
							{
								cons_com.weightx = 1;
								cons_com.weighty = 1;

								cons_com.gridx = 2;
								cons_com.gridy = 1;

								txtProject = new JTextField();
								pnlCompany.add(txtProject, cons_com);
								txtProject.setEditable(false);
								txtProject.setFont(FncGlobal.sizeTextValue);
							}
						}
					}
					{
						c.weightx = 1;
						c.weighty = 0.25;

						c.gridx = 0;
						c.gridy = 1;

						JPanel pnlRemarks = new JPanel(new GridBagLayout());
						pnlCenter.add(pnlRemarks, c);
						pnlRemarks.setBorder(JTBorderFactory.createTitleBorder("Remarks"));
						{
							GridBagConstraints cons_rem = new GridBagConstraints();
							cons_rem.fill = GridBagConstraints.BOTH;
							cons_rem.insets = new Insets(5, 5, 5, 5);
							{
								cons_rem.weightx = 0;
								cons_rem.weighty = 1;

								cons_rem.gridx = 0;
								cons_rem.gridy = 0;

								JLabel lblRemarks = new JLabel("Remarks");
								pnlRemarks.add(lblRemarks, cons_rem);
								lblRemarks.setFont(FncGlobal.sizeLabel);
							}
							{
								cons_rem.weightx = 1;
								cons_rem.weighty = 1;

								cons_rem.gridx = 1;
								cons_rem.gridy = 0;

								txtRemarks = new JXTextField("Enter remarks...");
								pnlRemarks.add(txtRemarks, cons_rem);
								txtRemarks.setFont(FncGlobal.sizeTextValue);
							}
						}
					}
					{
						c.weightx = 1;
						c.weighty = 2;

						c.gridx = 0;
						c.gridy = 2;

						JPanel pnlSearch = new JPanel(new GridBagLayout());
						pnlCenter.add(pnlSearch, c);
						pnlSearch.setBorder(JTBorderFactory.createTitleBorder("PCOST/TCOST"));
						{
							GridBagConstraints cons_sch = new GridBagConstraints();
							cons_sch.fill = GridBagConstraints.BOTH;
							cons_sch.insets = new Insets(5, 5, 5, 5);

							{
								cons_sch.weightx = 0;
								cons_sch.weighty = 0.25;

								cons_sch.gridx = 0;
								cons_sch.gridy = 0;

								JLabel lblSearch = new JLabel("**Search:");
								pnlSearch.add(lblSearch, cons_sch);
								lblSearch.setFont(FncGlobal.sizeLabel);
							}
							{
								cons_sch.weightx = 1;
								cons_sch.weighty = 0.25;

								cons_sch.gridx = 1;
								cons_sch.gridy = 0;

								txtSearch = new _JXTextField("Search DRF number...");
								pnlSearch.add(txtSearch, cons_sch);
								txtSearch.setFont(FncGlobal.sizeTextValue);
								txtSearch.addKeyListener(new KeyListener() {

									@Override
									public void keyTyped(KeyEvent e) {
										// TODO Auto-generated method stub

									}

									@Override
									public void keyReleased(KeyEvent e) {
										// TODO Auto-generated method stub
										searchBatchNo();

									}

									@Override
									public void keyPressed(KeyEvent e) {
										// TODO Auto-generated method stub

									}
								});
							}
							{
								cons_sch.weightx = 1;
								cons_sch.weighty = 2;

								cons_sch.gridx = 0;
								cons_sch.gridy = 1;

								cons_sch.gridwidth = 2;

								tabPane= new JTabbedPane(); 
								pnlSearch.add(tabPane, cons_sch);
								tabPane.setPreferredSize(new Dimension(0,500));
								{
									JPanel pnlPcost = new JPanel(new BorderLayout(5,5));
									tabPane.add("PCOST", pnlPcost);
									{
										scrollPCOST = new JScrollPane();
										pnlPcost.add(scrollPCOST);
										scrollPCOST.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
									}
									{
										modelPCOSTList = new modelTransactionSummary();
										tblPCOST = new _JTableMain(modelPCOSTList);

										scrollPCOST.setViewportView(tblPCOST);
										tblPCOST.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
										tblPCOST.setFont(FncGlobal.sizeTextValue);
									}
								}
								{
									JPanel pnlTcost = new JPanel(new BorderLayout(5,5));
									tabPane.add("TCOST", pnlTcost);
									{
										scrollTCOST = new JScrollPane();
										pnlTcost.add(scrollTCOST);
										scrollTCOST.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
									}
									{
										modelTCOSTList = new modelTransactionSummary();
										tblTCOST = new _JTableMain(modelTCOSTList);

										scrollTCOST.setViewportView(tblTCOST);
										tblTCOST.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
										tblTCOST.setFont(FncGlobal.sizeTextValue);
									}
								}
							}						
						}
					}
				}
			}
			{
				pnlSouth = new JPanel(new GridLayout(1,3,5,5));
				pnlMain.add(pnlSouth, BorderLayout.SOUTH);
				pnlSouth.setPreferredSize(new Dimension(0, 30));
				{
					btnSave = new JButton("Save");
					pnlSouth.add(btnSave);
					btnSave.setActionCommand("Save");
					btnSave.addActionListener(this);
					btnSave.setFont(FncGlobal.sizeControls);
					btnSave.setEnabled(false);
				}
				{
					btnPreview = new JButton("Preview");
					pnlSouth.add(btnPreview);
					btnPreview.setActionCommand("Show");
					btnPreview.addActionListener(this);
					btnPreview.setFont(FncGlobal.sizeControls);
					btnPreview.setEnabled(false);
				}
				{
					btnCancel = new JButton("Cancel");
					pnlSouth.add(btnCancel);
					btnCancel.setActionCommand("Cancel");
					btnCancel.addActionListener(this);
					btnCancel.setFont(FncGlobal.sizeControls);
				}
			}
		}
	}

	public void actionPerformed(ActionEvent e) {

		if(e.getActionCommand().equals("Save")) {		save();}

		if(e.getActionCommand().equals("Cancel")) {		cancel();}

		if(e.getActionCommand().equals("Show"))	{		showPreview();}

		if(e.getActionCommand().equals("Preview"))	{	previewReport();}

	}

	private void previewReport() {
		// TODO Auto-generated method stub
		Window optionPaneWindow = SwingUtilities.getWindowAncestor(pnlPreview);
		optionPaneWindow.dispose();

		String co_name = txtCompany.getText();
		String proj_name = txtProject.getText();
		String table = "";

		int index = tabPane.getSelectedIndex();
		if(index == 0) {
			table = "PCOST";
		}else {
			table = "TCOST";
		}

		java.util.Date date_from = dteDateFrom.getDate();
		java.util.Date date_to = dteDateTo.getDate();

		Map<String, Object> mapParameters = new HashMap<String, Object>();
		mapParameters.put("p_co_id", co_id);
		mapParameters.put("p_proj_id", proj_id);
		mapParameters.put("p_co_name", co_name);
		mapParameters.put("p_table", table);
		mapParameters.put("p_date_from", date_from);
		mapParameters.put("p_date_to", date_to);
		mapParameters.put("p_user", UserInfo.EmployeeCode);
		mapParameters.put("p_proj_name", proj_name);
		mapParameters.put("p_requester", UserInfo.FullName2);

		FncReport.generateReport("/Reports/rptTransactionRemarks.jasper", "Report", mapParameters);

	}

	private void showPreview() {
		JOptionPane.showOptionDialog(getContentPane(), pnlPreview, "Preview Report",
				JOptionPane.PLAIN_MESSAGE, JOptionPane.PLAIN_MESSAGE, null, new Object[] {}, null);

	}

	private void cancel() {

		co_id = "";
		proj_id = "";
		lookupCompany.setValue(null);
		lookupProject.setValue(null);
		txtCompany.setText("");
		txtProject.setText("");
		txtRemarks.setText("");
		txtSearch.setText("");
		modelPCOSTList.clear();
		modelTCOSTList.clear();
		btnSave.setEnabled(false);
		btnPreview.setEnabled(false);

	}
	
	private Boolean hasSelected(DefaultTableModel model) {
		ArrayList<Boolean> listSelected = new ArrayList<Boolean>();
		for(int x=0; x < model.getRowCount(); x++){
			listSelected.add((Boolean) model.getValueAt(x, 0));
		}
		return listSelected.contains(true);
	}

	private void save() {

		ArrayList<String> listBatch = new ArrayList<String>();
		
		if (tabPane.getSelectedIndex() == 0) {
			if (JOptionPane.showConfirmDialog(getContentPane(), "Do you want to save entries?", "Save", JOptionPane.YES_NO_OPTION,
					JOptionPane.QUESTION_MESSAGE)== JOptionPane.YES_OPTION) {
				for (int x = 0; x < modelPCOSTList.getRowCount(); x++) {
					Boolean isSelected = (Boolean) modelPCOSTList.getValueAt(x, 0);
					if(isSelected) {
						String batch_no = (String) modelPCOSTList.getValueAt(x, 1);
						String returned_check_no = (String) modelPCOSTList.getValueAt(x, 6);
						
						listBatch.add(String.format("%s", batch_no));

						//System.out.printf("The value of batch_no: (%s)\n", batch_no);

						String co_id = lookupCompany.getText();
						String remarks = txtRemarks.getText();
						String table = "PCOST";
						String user = UserInfo.EmployeeCode;

						String sql = "select sp_save_transaction_remarks_v2('"+co_id+"', '"+table+"', '"+batch_no+"', '"+remarks+"', '"+user+"', '"+returned_check_no+"')";

						FncSystem.out("SQL FOR SAVING REMARKS", sql);
						pgSelect db = new pgSelect();
						db.select(sql);


					}	
				}
			}

			if(listBatch.isEmpty()) {
				JOptionPane.showMessageDialog(getContentPane(), "Please select a row first!", "Error", JOptionPane.ERROR_MESSAGE);
			}else {




			}	

			JOptionPane.showMessageDialog(getContentPane(), "Successfully saved!", "Save", JOptionPane.INFORMATION_MESSAGE);
			displayPCOST(modelPCOSTList, co_id);
		}

		if (tabPane.getSelectedIndex() == 1) {

			for (int x = 0; x < modelTCOSTList.getRowCount(); x++) {
				Boolean isSelected = (Boolean) modelTCOSTList.getValueAt(x, 0);
				if(isSelected) {
					String batch_no = (String) modelTCOSTList.getValueAt(x, 1);
					listBatch.add(String.format("%s", batch_no));
				}
			}

			if(listBatch.isEmpty()) {
				JOptionPane.showMessageDialog(getContentPane(), "Please select first for preview!", "Error", JOptionPane.ERROR_MESSAGE);
			}else {

				if (JOptionPane.showConfirmDialog(getContentPane(), "Do you want to save entries?", "Save", JOptionPane.YES_NO_OPTION,
						JOptionPane.QUESTION_MESSAGE)== JOptionPane.YES_OPTION) {

					String batch_no = listBatch.toString().replaceAll("\\[", "").replaceAll("\\]","");
					System.out.printf("The value of batch_no: (%s)\n", batch_no);

					String co_id = lookupCompany.getText();
					String remarks = txtRemarks.getText();
					String table = "TCOST";
					String user = UserInfo.EmployeeCode;

					String sql = "select sp_save_transaction_remarks('"+co_id+"', '"+table+"', '"+batch_no+"', '"+remarks+"', '"+user+"')";

					FncSystem.out("SQL FOR SAVING REMARKS", sql);
					pgSelect db = new pgSelect();
					db.select(sql);

					JOptionPane.showMessageDialog(getContentPane(), "Successfully saved!", "Save", JOptionPane.INFORMATION_MESSAGE);
					displayTCOST(modelTCOSTList, co_id);
				}
			}
		}
	}

	private void displayPCOST(final DefaultTableModel modelMain, final String co_id) {

		SwingWorker sw = new SwingWorker() {
			protected Object doInBackground()
					throws FileNotFoundException, IOException, InterruptedException {
				FncGlobal.startProgress("Loading...");

				modelMain.setRowCount(0);
				DefaultListModel listModel = new DefaultListModel();

				String sql = 
						"select distinct on (a.batch_no::int)\n" + 
								"false,\n" + 
								"a.batch_no,\n" + 
								"c.entity_name,\n" + 
								"a.rplf_no,\n" + 
								"a.status_id,\n" + 
								"a.tran_date::date\n" + 
								"from rf_processing_cost a\n" + 
								"left join em_employee b on a.created_by = b.emp_code\n" + 
								"left join rf_entity c on b.entity_id = c.entity_id\n" + 
								"where a.co_id = '"+co_id+"'\n" + 
								"and a.status_id = 'A'\n" + 
								"and not exists (select rplf_no from tmp_transaction_remarks where rplf_no = a.rplf_no and co_id = a.co_id and proj_id = a.projcode and status_id = 'A' and trans_type = 'P')\n" +
								"group by a.batch_no, c.entity_name, a.rplf_no, a.tran_date, a.status_id, a.date_created, a.pcostid_dl\n" + 
								"order by a.batch_no::int DESC";


				FncSystem.out("displayPCOST", sql);
				pgSelect db = new pgSelect();
				db.select(sql);

				if(db.isNotNull()) {
					for(int x=0; x < db.getRowCount(); x++){
						modelMain.addRow(db.getResult()[x]);
						listModel.addElement(modelMain.getRowCount());
					}
				}

				tblPCOST.packAll();

				FncGlobal.stopProgress();
				return null;
			}
		};
		sw.execute();

	}

	private void displayTCOST(final DefaultTableModel modelMain, final String co_id) {

		SwingWorker sw = new SwingWorker() {
			protected Object doInBackground()
					throws FileNotFoundException, IOException, InterruptedException {
				FncGlobal.startProgress("Loading...");

				modelMain.setRowCount(0);
				DefaultListModel listModel = new DefaultListModel();

				String sql = 
						"select distinct on (a.batch_no::int)\n" + 
								"false,\n" + 
								"a.batch_no,\n" + 
								"c.entity_name,\n" + 
								"a.rplf_no,\n" + 
								"a.status_id,\n" + 
								"a.tran_date::date\n" + 
								"from rf_transfer_cost a\n" + 
								"left join em_employee b on a.created_by = b.emp_code\n" + 
								"left join rf_entity c on b.entity_id = c.entity_id\n" + 
								"where a.co_id = '"+co_id+"'\n" + 
								"and a.status_id = 'A'\n" + 
								"and not exists (select rplf_no from tmp_transaction_remarks where rplf_no = a.rplf_no and co_id = a.co_id and proj_id = a.projcode and status_id = 'A' and trans_type = 'T')\n" +
								"group by a.batch_no, c.entity_name, a.rplf_no, a.tran_date, a.status_id, a.date_created, a.tcostid_dl\n" + 
								"order by a.batch_no::int DESC";


				FncSystem.out("displayTCOST", sql);
				pgSelect db = new pgSelect();
				db.select(sql);

				if(db.isNotNull()) {
					for(int x=0; x < db.getRowCount(); x++){
						modelMain.addRow(db.getResult()[x]);
						listModel.addElement(modelMain.getRowCount());
					}
				}

				tblTCOST.packAll();


				FncGlobal.stopProgress();
				return null;
			}
		};
		sw.execute();
	}

	private void searchBatchNo() {

		if (tabPane.getSelectedIndex() == 0) {

			int rw = tblPCOST.getModel().getRowCount();
			int x = 0;

			while (x < rw) {

				String rplf = "";

				try {
					rplf = tblPCOST.getValueAt(x, 3).toString().toUpperCase();
				} catch (NullPointerException e) {
					rplf = "";
				}

				String strBatch = txtSearch.getText().trim().toUpperCase();
				// Boolean match = name.indexOf(acct_name)>0;
				Boolean start = rplf.contains(strBatch);
				// Boolean end = name.endsWith(module_name);

				if (start == true) {
					tblPCOST.setRowSelectionInterval(x, x);
					tblPCOST.changeSelection(x, 3, false, false);
					break;
				} else {
					tblPCOST.setRowSelectionInterval(0, 0);
					tblPCOST.changeSelection(0, 3, false, false);
				}

				x++;
			}
		}

		if (tabPane.getSelectedIndex() == 1) {

			int rw = tblTCOST.getModel().getRowCount();
			int x = 0;

			while (x < rw) {

				String rplf = "";

				try {
					rplf = tblTCOST.getValueAt(x, 3).toString().toUpperCase();
				} catch (NullPointerException e) {
					rplf = "";
				}

				String strBatch = txtSearch.getText().trim().toUpperCase();
				// Boolean match = name.indexOf(acct_name)>0;
				Boolean start = rplf.contains(strBatch);
				// Boolean end = name.endsWith(module_name);

				if (start == true) {
					tblTCOST.setRowSelectionInterval(x, x);
					tblTCOST.changeSelection(x, 3, false, false);
					break;
				} else {
					tblTCOST.setRowSelectionInterval(0, 0);
					tblTCOST.changeSelection(0, 3, false, false);
				}

				x++;
			}
		}
	}
}
