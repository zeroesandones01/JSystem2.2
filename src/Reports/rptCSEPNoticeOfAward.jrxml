<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptCSEPNoticeOfAward" pageWidth="612" pageHeight="792" columnWidth="572" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="528"/>
	<parameter name="subrptNoticeOfAward" class="java.io.InputStream" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="ntp_no" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["000087"]]></defaultValueExpression>
	</parameter>
	<parameter name="prepared_by" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["AAGONZALES"]]></defaultValueExpression>
	</parameter>
	<parameter name="logo" class="java.io.InputStream" isForPrompting="false">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="hasDP" class="java.lang.Boolean" isForPrompting="false"/>
	<parameter name="subrptLandDevContractUnits" class="java.io.InputStream" isForPrompting="false">
		<defaultValueExpression><![CDATA[this.getClass().getResourceAsStream("/Reports/subrptOSPContractUnits_NA.jasper")]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
a.award_date, a.contract_no,
b.entity_name,
 get_client_address_for2307(a.entity_id) as address, f.contactperson, f.position, c.proj_name, d._count,
to_words(d._count::VARCHAR) AS  _word,
a.orig_contract_price,
UPPER(FORMAT('%s', to_words_v2(a.orig_contract_price))) AS orig_contract_price_word,
a.dp_percentage,
to_words(a.dp_percentage::VARCHAR) as dp_percentage_word,
a.start_date,
a.finish_date,
date_part('day', timestamp_mi(timestamp_pl_interval(a.finish_date, INTERVAL '1 day'), a.start_date))::INT AS working_days,
to_words(date_part('day', timestamp_mi(timestamp_pl_interval(a.finish_date, INTERVAL '1 day'), a.start_date))::VARCHAR) AS  working_days_word,
trim(e.company_name) as company,
CASE WHEN $P{ntp_no} = '002041' THEN 'PHASE 5A'
	 WHEN (a.co_id = '01' and a.proj_id = '019' AND a.sub_proj_id = '015') THEN 'PHASE 1-B'
 ELSE(select (select initcap(sub_proj_name) from mf_sub_project where proj_id = a.proj_id and replace(sub_proj_alias, ' ', '') = replace((case when a.phase = 'PH4A' then 'PH4-A' else a.phase end ), ' ', ''))
	from (select regexp_split_to_table(contract_no, '-') as phase, proj_id
		from co_ntp_header
		where ntp_no = $P{ntp_no}) a
	where a.phase ~* 'PH') END as phase,
(select replace(replace(replace((array_agg((other_cost = 4550.0000)::text))::text, '{'::text, ''::text), '}'::text, ''::text), '"'::text, ''::text) from co_ntp_detail WHERE ntp_no = $P{ntp_no}) as isCSEMetering,

case when $P{ntp_no} IN ('002141') THEN upper((select replace(replace(replace((array_agg(REPLACE(work_desc, '&', '&#038;')))::text, '{'::text, ''::text), '}'::text, ''::text), '"'::text, ''::text) from co_ntp_detail WHERE ntp_no = '002141'))
else
upper((select replace(replace(replace((array_agg(REPLACE(ntp_subject_description, '&', '&#038;')))::text, '{'::text, ''::text), '}'::text, ''::text), '"'::text, ''::text) from co_ntp_subjects WHERE ntp_no = $P{ntp_no})) end as title,

a.oth_description, a.entity_id, a.ntp_type_id,

(select concat('Brgy. ', x.barangay, ', municipality of ', x.municipality, ', in the province of ', x.province) as address from mf_project x where x.proj_name = c.proj_name limit 1) as project_address,

(select concat('Brgy. ', x.barangay, ', municipality of ', x.municipality, ', in the province of ', x.province) as address from mf_project x where x.proj_name = c.proj_name limit 1) as project_address,a.oth_description,
(select left(trim(contacts), length(trim(contacts))-1) as contacts
from (SELECT coalesce(replace(replace(replace(replace(replace(
(select x.mobile::varchar || ', ' || x.telephone::varchar from rf_contacts x where x.entity_id = y.entity_id and x.status_id = 'A')
, '{', ''), '}', ''), '"', ''), '-', ''), ';', ''), '') as contacts FROM rf_entity y WHERE y.entity_id = a.entity_id) z) as contact_no
FROM co_ntp_header a
LEFT JOIN rf_entity b ON b.entity_id = a.entity_id
LEFT JOIN mf_project c ON c.proj_id = a.proj_id
LEFT JOIN (SELECT count(ntp_no) AS _count, ntp_no FROM co_ntp_detail WHERE ntp_no = $P{ntp_no} GROUP BY ntp_no) d ON d.ntp_no = a.ntp_no
LEFT JOIN mf_company e ON e.co_id = a.co_id
LEFT JOIN rf_contacts f ON f.entity_id = a.entity_id
WHERE a.ntp_no = $P{ntp_no};]]>
	</queryString>
	<field name="award_date" class="java.sql.Timestamp"/>
	<field name="contract_no" class="java.lang.String"/>
	<field name="entity_name" class="java.lang.String"/>
	<field name="address" class="java.lang.String"/>
	<field name="contactperson" class="java.lang.String"/>
	<field name="position" class="java.lang.String"/>
	<field name="proj_name" class="java.lang.String"/>
	<field name="_count" class="java.lang.Long"/>
	<field name="_word" class="java.lang.String"/>
	<field name="orig_contract_price" class="java.math.BigDecimal"/>
	<field name="orig_contract_price_word" class="java.lang.String"/>
	<field name="dp_percentage" class="java.math.BigDecimal"/>
	<field name="dp_percentage_word" class="java.lang.String"/>
	<field name="start_date" class="java.sql.Timestamp"/>
	<field name="finish_date" class="java.sql.Timestamp"/>
	<field name="working_days" class="java.lang.Integer"/>
	<field name="working_days_word" class="java.lang.String"/>
	<field name="company" class="java.lang.String"/>
	<field name="phase" class="java.lang.String"/>
	<field name="iscsemetering" class="java.lang.String"/>
	<field name="title" class="java.lang.String"/>
	<field name="oth_description" class="java.lang.String"/>
	<field name="entity_id" class="java.lang.String"/>
	<field name="ntp_type_id" class="java.lang.String"/>
	<field name="project_address" class="java.lang.String"/>
	<field name="contact_no" class="java.lang.String"/>
	<variable name="CURRENT_PAGE_NUMBER" class="java.lang.Integer" resetType="Page">
		<variableExpression><![CDATA[$V{PAGE_NUMBER}]]></variableExpression>
		<initialValueExpression><![CDATA[]]></initialValueExpression>
	</variable>
	<variable name="contract_price" class="java.lang.String">
		<variableExpression><![CDATA[new DecimalFormat("#,##0.00").format($F{orig_contract_price})]]></variableExpression>
	</variable>
	<variable name="start_date" class="java.lang.String">
		<variableExpression><![CDATA[new SimpleDateFormat("MMMMM dd, YYYY").format($F{start_date})]]></variableExpression>
	</variable>
	<title>
		<band height="79" splitType="Stretch">
			<textField>
				<reportElement x="10" y="29" width="550" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="15" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{company}.toUpperCase()]]></textFieldExpression>
			</textField>
			<image hAlign="Center" vAlign="Middle">
				<reportElement x="30" y="15" width="50" height="50"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<imageExpression class="java.io.InputStream"><![CDATA[$P{logo}]]></imageExpression>
			</image>
		</band>
	</title>
	<detail>
		<band height="344" splitType="Stretch">
			<frame>
				<reportElement positionType="Float" x="10" y="70" width="550" height="60"/>
				<staticText>
					<reportElement positionType="Float" x="0" y="0" width="80" height="30"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Tahoma" size="12"/>
					</textElement>
					<text><![CDATA[To:]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="0" width="470" height="30"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{entity_name}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="30" width="470" height="30"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{address}]]></textFieldExpression>
				</textField>
			</frame>
			<frame>
				<reportElement positionType="Float" x="10" y="130" width="550" height="90"/>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="30" width="470" height="30"/>
					<textElement verticalAlignment="Top" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{position}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement positionType="Float" x="0" y="0" width="80" height="30"/>
					<textElement verticalAlignment="Middle">
						<font fontName="Tahoma" size="12"/>
					</textElement>
					<text><![CDATA[Attention:]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" pattern="">
					<reportElement positionType="Float" x="80" y="0" width="470" height="30"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{contactperson}]]></textFieldExpression>
				</textField>
			</frame>
			<frame>
				<reportElement positionType="Float" x="10" y="222" width="550" height="30"/>
				<textField isStretchWithOverflow="true" pattern="" isBlankWhenNull="true">
					<reportElement positionType="Float" x="80" y="0" width="470" height="30"/>
					<textElement verticalAlignment="Middle" markup="none">
						<font fontName="Tahoma" size="12" isBold="true"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$F{proj_name} + " " + ($F{phase} == null ? "":$F{phase}.toUpperCase()) + " SUBDIVISION"]]></textFieldExpression>
				</textField>
			</frame>
			<staticText>
				<reportElement positionType="Float" x="10" y="0" width="80" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="12"/>
				</textElement>
				<text><![CDATA[Date:]]></text>
			</staticText>
			<textField pattern="dd MMMMM yyyy">
				<reportElement positionType="Float" x="90" y="0" width="470" height="30"/>
				<textElement verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.sql.Timestamp"><![CDATA[$F{award_date}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="10" y="35" width="80" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="12"/>
				</textElement>
				<text><![CDATA[Ref. No.:]]></text>
			</staticText>
			<textField pattern="">
				<reportElement positionType="Float" x="90" y="35" width="470" height="30"/>
				<textElement verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{contract_no}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="10" y="292" width="169" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Gentlemen:]]></text>
			</staticText>
			<textField isStretchWithOverflow="true">
				<reportElement positionType="Float" x="10" y="322" width="550" height="20"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Justified" markup="styled">
					<font fontName="Tahoma" size="11" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["We refer to our previous negotiation pertaining to the <b>\n" + $F{title} + "</b> at <b>"+ $F{proj_name} + " " + ($F{phase} == null ? "":$F{phase}.toUpperCase()) +"</b> of subject project located in "+$F{project_address}+" and are pleased to inform you of our intent to award you the above mentioned works package." +
"\n\n" +
"The <b>COST OF THE PROJECT</b> shall be <b>Philippine Pesos</b>: <b>"+ $F{orig_contract_price_word} +"</b> (<b>PHP "+ $V{contract_price} +"</b>) which shall be payment for all materials, labor and supervision, tools and equipment, fuels and oils, temporary facilities, profits, VAT and taxes and other incidentals necessary for the proper and immediate execution of the following works, breakdown of which are contained at attached tabulation of quantities, marked as Annex A and made an integral part hereof, to include:"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="">
				<reportElement positionType="Float" x="90" y="252" width="470" height="20"/>
				<textElement verticalAlignment="Middle" markup="styled">
					<font fontName="Tahoma" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{title}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="">
				<reportElement positionType="Float" x="90" y="272" width="470" height="20"/>
				<textElement verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["NOTICE OF AWARD / TO PROCEED"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="">
				<reportElement positionType="Float" x="90" y="190" width="470" height="30"/>
				<textElement verticalAlignment="Top" markup="none">
					<font fontName="Tahoma" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Contact No(s): "+$F{contact_no}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement positionType="Float" x="10" y="220" width="80" height="30"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" size="12"/>
				</textElement>
				<text><![CDATA[Subject]]></text>
			</staticText>
		</band>
		<band height="59" splitType="Stretch">
			<subreport>
				<reportElement x="10" y="0" width="293" height="40"/>
				<subreportParameter name="ntp_type_id">
					<subreportParameterExpression><![CDATA[$F{ntp_type_id}]]></subreportParameterExpression>
				</subreportParameter>
				<subreportParameter name="ntp_no">
					<subreportParameterExpression><![CDATA[$P{ntp_no}]]></subreportParameterExpression>
				</subreportParameter>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression class="java.io.InputStream"><![CDATA[this.getClass().getResourceAsStream("/Reports/subrptCSENoticeAward.jasper")]]></subreportExpression>
			</subreport>
			<textField>
				<reportElement positionType="Float" x="10" y="40" width="540" height="13"/>
				<textElement markup="styled">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{ntp_no}.equals("000032") ? "": "Hauling and disposal of excess materials."]]></textFieldExpression>
			</textField>
		</band>
		<band height="20">
			<textField isStretchWithOverflow="true">
				<reportElement x="10" y="0" width="550" height="20"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Justified" markup="styled">
					<font fontName="Tahoma" size="12" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[($P{hasDP} ?
$P{ntp_no}.equals("002041") ?
"A <b>down payment equivalent TEN THOUSAND AND XX/100 (PHP 10,000.00)</b> of above project cost shall be billable upon mobilization of your equipment at site which shall be recouped proportionately from the stage billing. Ten percent (10%) of the Contract Price shall be retained by the OWNER deducted proportionately from the STAGE billings of the CONTRACTOR. The amounts retained by the OWNER shall be non-interest bearing and shall be held by the OWNER until the warranty period specified in Article VIII hereof expires.":
"A <b>down payment equivalent "+$F{dp_percentage_word}+" percent ("+$F{dp_percentage}+"%)</b> of above project cost shall be billable upon mobilization of your equipment at site which shall be recouped proportionately from the stage billing. Ten percent (10%) of the Contract Price shall be retained by the OWNER deducted proportionately from the STAGE billings of the CONTRACTOR. The amounts retained by the OWNER shall be non-interest bearing and shall be held by the OWNER until the warranty period specified in Article VIII hereof expires."

:

"No downpayment required.") +

"Final billing shall be subject to <b>ten percent (10%) retention</b>." +

"\n\n" +

"This will also serve as <b>notice</b> for you to mobilize your men and equipment and commence work on or before <b>"+ $V{start_date} +"</b> and complete above works within <b>"+ $F{working_days_word} +" ("+ $F{working_days} +")</b> Calendar days reckoned from said start date. Failure to complete the Works within the specified time shall be ground for <b>"+ $F{company} +"</b> to impose Liquidated Damages equivalent to one-tenth of one percent (1/10 of 1 %) of the above project cost per day of delay." +

"\n\n\n" +

"We are attaching the following documents (Annexes) embodying details thereof as mutually agreed by us that shall be deemed binding prior to the preparation of a Formal Contract Agreement for above Work Package." +

"\n\n\n" +

"We look forward to a harmonious and close association with you in completing the above works on schedule and with your support." +

"\n\n\n" +

"Very truly yours," +

"\n\n\n" +

"<b>" + $F{company} + "</b>" +

"\n\n\n" +

"<b>ATTY. ANGELICA ERNESTINE L. BAROÃ‘A</b>" +

"\n\n" +

"<b>(LLD Head)</b>"]]></textFieldExpression>
			</textField>
		</band>
		<band height="22">
			<textField isStretchWithOverflow="true">
				<reportElement x="269" y="2" width="303" height="20"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement markup="html">
					<font fontName="Tahoma" size="12" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["\n\n\n<b>Conforme:</b>" +

"<br><br>" +

"<b>"+$F{entity_name}+"</b>"+


"<br><br><br><br>" +

"<b>" + $F{contactperson} + "</b><br>" +
"<b>" + $F{position} + "</b>"]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="15">
			<textField isStretchWithOverflow="true" evaluationTime="Auto">
				<reportElement positionType="Float" x="422" y="3" width="150" height="12"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font size="7" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["As of: " + new SimpleDateFormat("EEE MMM dd, yyyy hh:mm a").format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" evaluationTime="Auto">
				<reportElement positionType="Float" x="0" y="3" width="200" height="12"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font size="7" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["/" + $P{prepared_by}.toUpperCase()]]></textFieldExpression>
			</textField>
			<frame>
				<reportElement x="219" y="3" width="120" height="12"/>
				<textField pattern="" isBlankWhenNull="false">
					<reportElement mode="Transparent" x="0" y="0" width="80" height="12" forecolor="#000000" backcolor="#FFFFFF"/>
					<textElement textAlignment="Right" verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="7" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
				</textField>
				<textField evaluationTime="Report" pattern="" isBlankWhenNull="false">
					<reportElement mode="Transparent" x="80" y="0" width="40" height="12" forecolor="#000000" backcolor="#FFFFFF"/>
					<textElement verticalAlignment="Middle" rotation="None" markup="none">
						<font fontName="SansSerif" size="7" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
						<paragraph lineSpacing="Single"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
				</textField>
			</frame>
		</band>
	</columnFooter>
</jasperReport>
