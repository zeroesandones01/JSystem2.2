<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="subrptPcostSummaryPhase_revise_meralco" pageWidth="290" pageHeight="290" columnWidth="290" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.zoom" value="2.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="batch_no" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="rplf_no" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT a.phase, count(a.phase)::INT, sum(a.pcost_amt) as pcost_amt, a.rpt_desc,
case when  a.rpt_desc = 'W/O ADVANCED PAYMENT FOR RPT' then sum(a.pcost_amt) else 0.00 end as woutadv,
case when  a.rpt_desc = 'W/ ADVANCED PAYMENT FOR RPT' then sum(a.pcost_amt) else 0.00 end as wadv
FROM (

SELECT b.phase, a.pcost_amt, case when c.rpt_amt is null then 'W/O ADVANCED PAYMENT FOR RPT' ELSE 'W/ ADVANCED PAYMENT FOR RPT' END AS rpt_desc
from rf_processing_cost a
LEFT JOIN mf_unit_info b on TRIM(b.proj_id) = TRIM(a.projcode) and TRIM(b.pbl_id) = TRIM(a.pbl_id)
left join rf_pagibig_computation c on c.entity_id = a.entity_id and c.proj_id = a.projcode and c.pbl_id = a.pbl_id and c.seq_no = a.seq_no and c.status_id = 'A'
WHERE a.batch_no = $P{batch_no}
AND a.status_id = 'A'
AND a.rplf_no = $P{rplf_no}
) a
GROUP by a.phase, a.rpt_desc
ORDER BY a.phase]]>
	</queryString>
	<field name="phase" class="java.lang.String"/>
	<field name="count" class="java.lang.Integer"/>
	<field name="pcost_amt" class="java.math.BigDecimal"/>
	<field name="rpt_desc" class="java.lang.String"/>
	<field name="woutadv" class="java.math.BigDecimal"/>
	<field name="wadv" class="java.math.BigDecimal"/>
	<variable name="total_unit" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$F{count}]]></variableExpression>
	</variable>
	<variable name="total_rpt" class="java.math.BigDecimal" resetType="Column" calculation="Sum">
		<variableExpression><![CDATA[$F{pcost_amt}]]></variableExpression>
		<initialValueExpression><![CDATA[]]></initialValueExpression>
	</variable>
	<variable name="total_wout_rpt" class="java.math.BigDecimal" resetType="Column" calculation="Sum">
		<variableExpression><![CDATA[$F{woutadv}]]></variableExpression>
	</variable>
	<group name="grpBatch">
		<groupExpression><![CDATA[$P{batch_no}]]></groupExpression>
		<groupHeader>
			<band height="15">
				<staticText>
					<reportElement x="0" y="0" width="276" height="15"/>
					<box>
						<leftPen lineWidth="0.5"/>
						<bottomPen lineWidth="0.5"/>
						<rightPen lineWidth="0.5"/>
					</box>
					<textElement/>
					<text><![CDATA[]]></text>
				</staticText>
				<textField isStretchWithOverflow="true">
					<reportElement x="37" y="0" width="81" height="15"/>
					<box>
						<pen lineWidth="0.0"/>
						<topPen lineWidth="0.0"/>
						<bottomPen lineWidth="0.0"/>
					</box>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font fontName="Tahoma" size="8"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{batch_no}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<columnHeader>
		<band height="34" splitType="Stretch">
			<rectangle>
				<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="276" height="34"/>
			</rectangle>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="170" y="19" width="106" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="0" y="19" width="35" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Phase]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="0" y="0" width="151" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="1.0"/>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[SUMMARY BY PHASE - BATCH ]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="118" y="19" width="52" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Units]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="37" y="19" width="81" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Batch]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="16" splitType="Stretch">
			<textField isStretchWithOverflow="true">
				<reportElement x="0" y="0" width="37" height="16"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{phase}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;(#,##0.00)">
				<reportElement x="175" y="0" width="101" height="16"/>
				<box>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{pcost_amt}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="118" y="0" width="52" height="16"/>
				<box>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{count}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="47" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="0" y="0" width="118" height="25"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Bottom" markup="none">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Grand Total"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="118" y="0" width="52" height="25"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{total_unit}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;(#,##0.00)">
				<reportElement x="170" y="0" width="106" height="25"/>
				<box>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{total_rpt}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
