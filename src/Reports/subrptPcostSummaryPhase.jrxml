<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="subrptPcostSummaryPhase" pageWidth="290" pageHeight="290" columnWidth="290" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.zoom" value="3.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="batch_no" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="comp_id" class="java.lang.String"/>
	<queryString>
		<![CDATA[SELECT a.phase, count(a.phase)::INT, sum(a.pcost_amt) as pcost_amt, a.rpt_desc,
case when  a.rpt_desc = 'W/O ADVANCED PAYMENT FOR RPT' then sum(a.pcost_amt) else 0.00 end as woutadv,
case when  a.rpt_desc = 'W/ ADVANCED PAYMENT FOR RPT' then sum(a.pcost_amt) else 0.00 end as wadv
FROM (

SELECT b.phase, a.pcost_amt, case
when
	(
		select
		pbl_id
		from hs_sold_other_lots x
		where x.oth_pbl_id = a.pbl_id
		and exists (select rpt_amt from rf_pagibig_computation where pbl_id = x.pbl_id and seq_no = x.seq_no and proj_id = x.proj_id and coalesce(x.server_id, '') = coalesce(server_id, '') )
	) is not null then 'W/ ADVANCED PAYMENT FOR RPT'
when c.rpt_amt is null then 'W/O ADVANCED PAYMENT FOR RPT' ELSE 'W/ ADVANCED PAYMENT FOR RPT' END AS rpt_desc
from rf_processing_cost a
LEFT JOIN mf_unit_info b on TRIM(b.proj_id) = TRIM(a.projcode) and TRIM(b.pbl_id) = TRIM(a.pbl_id)
left join rf_pagibig_computation c on c.entity_id = a.entity_id and c.proj_id = a.projcode and c.pbl_id = a.pbl_id and c.seq_no = a.seq_no and c.status_id = 'A'
WHERE a.batch_no = $P{batch_no}
AND a.status_id = 'A'
AND a.co_id = $P{comp_id}
) a
GROUP by a.phase, a.rpt_desc
ORDER BY a.phase]]>
	</queryString>
	<field name="phase" class="java.lang.String"/>
	<field name="count" class="java.lang.Integer"/>
	<field name="pcost_amt" class="java.math.BigDecimal"/>
	<field name="rpt_desc" class="java.lang.String"/>
	<field name="woutadv" class="java.math.BigDecimal"/>
	<field name="wadv" class="java.math.BigDecimal"/>
	<variable name="total_unit" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$F{count}]]></variableExpression>
	</variable>
	<variable name="total_rpt" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{wadv}]]></variableExpression>
	</variable>
	<variable name="total_wout_rpt" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{woutadv}]]></variableExpression>
	</variable>
	<group name="grpBatch">
		<groupExpression><![CDATA[$P{batch_no}]]></groupExpression>
		<groupHeader>
			<band height="15">
				<textField isStretchWithOverflow="true">
					<reportElement x="37" y="0" width="50" height="15"/>
					<box>
						<pen lineWidth="0.0"/>
						<topPen lineWidth="0.0"/>
						<bottomPen lineWidth="0.0"/>
					</box>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font fontName="Tahoma" size="8"/>
					</textElement>
					<textFieldExpression class="java.lang.String"><![CDATA[$P{batch_no}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
	</group>
	<columnHeader>
		<band height="34" splitType="Stretch">
			<rectangle>
				<reportElement positionType="FixRelativeToBottom" stretchType="RelativeToBandHeight" x="0" y="0" width="290" height="34"/>
			</rectangle>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="166" y="4" width="124" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Amount]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="37" y="19" width="50" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Batch]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="3" y="19" width="32" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Phase]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="0" y="0" width="151" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="1.0"/>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[SUMMARY BY PHASE - BATCH]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="129" y="19" width="33" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[Units]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="166" y="19" width="58" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[W/RPT]]></text>
			</staticText>
			<staticText>
				<reportElement positionType="Float" mode="Transparent" x="230" y="19" width="60" height="15"/>
				<box topPadding="0" leftPadding="1" bottomPadding="0">
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="9"/>
				</textElement>
				<text><![CDATA[W/O RPT]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="18" splitType="Stretch">
			<textField isStretchWithOverflow="true">
				<reportElement x="3" y="1" width="32" height="15"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{phase}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="129" y="0" width="33" height="15"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{count}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#,##0.00;(#,##0.00)">
				<reportElement x="166" y="0" width="62" height="15">
					<printWhenExpression><![CDATA[$F{rpt_desc}.equals("W/ ADVANCED PAYMENT FOR RPT")]]></printWhenExpression>
				</reportElement>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{wadv}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" pattern="#,##0.00;(#,##0.00)">
				<reportElement x="228" y="0" width="62" height="15">
					<printWhenExpression><![CDATA[$F{rpt_desc}.equals("W/O ADVANCED PAYMENT FOR RPT")]]></printWhenExpression>
				</reportElement>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{woutadv}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="28" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="37" y="0" width="82" height="15"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Right" verticalAlignment="Middle" markup="none">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Grand Total"]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true">
				<reportElement x="129" y="0" width="33" height="15"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{total_unit}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;(#,##0.00)">
				<reportElement x="166" y="0" width="62" height="15"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{total_rpt}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00;(#,##0.00)">
				<reportElement x="228" y="0" width="62" height="15"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="7"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$V{total_wout_rpt}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
