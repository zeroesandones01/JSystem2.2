<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="subtptAddendumToCTS_Page2" pageWidth="531" pageHeight="792" columnWidth="531" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="entity_id" class="java.lang.String" isForPrompting="false"/>
	<parameter name="proj_id" class="java.lang.String" isForPrompting="false"/>
	<parameter name="pbl_id" class="java.lang.String" isForPrompting="false"/>
	<parameter name="seq_no" class="java.lang.Integer" isForPrompting="false"/>
	<queryString>
		<![CDATA[SELECT _row, (CASE WHEN stage = 1 THEN 'TEMPORARY RESERVATION' WHEN stage = 2 THEN 'OFFICIAL RESERVATION' END) as particular, schedule, amount
FROM (SELECT 0 as _row, ROW_NUMBER() OVER (ORDER BY scheddate) as stage, to_char(scheddate, 'FMMon dd YYYY') as schedule, to_char(amount, 'FM999,999,990.00') as amount
  FROM rf_client_schedule
  WHERE entity_id = $P{entity_id} AND proj_id = $P{proj_id} AND pbl_id = $P{pbl_id} AND seq_no = $P{seq_no} AND part_id = '012') a

UNION

SELECT _row, FORMAT('CASH OUTLAY(%s)', _row) as particular, schedule, amount
FROM (SELECT 1 as _row, ROW_NUMBER() OVER (ORDER BY scheddate) as stage, to_char(scheddate, 'FMMon dd YYYY') as schedule, to_char(amount, 'FM999,999,990.00') as amount
  FROM rf_client_schedule
  WHERE entity_id = $P{entity_id} AND proj_id = $P{proj_id} AND pbl_id = $P{pbl_id} AND seq_no = $P{seq_no} AND part_id = '013') a
WHERE stage = 1

UNION

SELECT _row, FORMAT('CASH OUTLAY(%s)', _row) as particular, FORMAT('%s - %s', scheddate[1], scheddate[array_length(scheddate)]) as schedule, amount
FROM (SELECT _row, ARRAY_AGG(scheddate) as scheddate, FORMAT('%s/month', to_char(amount, 'FM999,999,990.00')) as amount
  FROM (SELECT 2 as _row, ROW_NUMBER() OVER (ORDER BY scheddate) as stage, to_char(scheddate, 'FMMon dd YYYY') as scheddate, amount
    FROM rf_client_schedule
    WHERE entity_id = $P{entity_id} AND proj_id = $P{proj_id} AND pbl_id = $P{pbl_id} AND seq_no = $P{seq_no} AND part_id = '013') a
  WHERE stage > 1
  GROUP BY _row, amount) b

ORDER BY _row;]]>
	</queryString>
	<field name="_row" class="java.lang.Integer"/>
	<field name="particular" class="java.lang.String"/>
	<field name="schedule" class="java.lang.String"/>
	<field name="amount" class="java.lang.String"/>
	<columnHeader>
		<band height="12" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="191" height="12"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[PARTICULARS]]></text>
			</staticText>
			<staticText>
				<reportElement x="191" y="0" width="189" height="12"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[SCHEDULE]]></text>
			</staticText>
			<staticText>
				<reportElement x="380" y="0" width="151" height="12"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[AMOUNT]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="12" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="191" height="12"/>
				<box leftPadding="5">
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Times New Roman" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{particular}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="191" y="0" width="189" height="12"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{schedule}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="380" y="0" width="151" height="12"/>
				<box>
					<pen lineWidth="0.5"/>
					<topPen lineWidth="0.5"/>
					<leftPen lineWidth="0.5"/>
					<bottomPen lineWidth="0.5"/>
					<rightPen lineWidth="0.5"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{amount}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
