<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptSORQualifiedAccounts" pageWidth="612" pageHeight="792" columnWidth="572" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.7715610000000015"/>
	<property name="ireport.x" value="61"/>
	<property name="ireport.y" value="29"/>
	<parameter name="listSORQualifiedAccounts" class="java.util.ArrayList" isForPrompting="false"/>
	<parameter name="SUBREPORT_DIR" class="java.io.InputStream" isForPrompting="false"/>
	<parameter name="proj_id" class="java.lang.String" isForPrompting="false"/>
	<parameter name="sub_proj_id" class="java.lang.String" isForPrompting="false"/>
	<parameter name="bank_id" class="java.lang.String" isForPrompting="false"/>
	<parameter name="cut_off_date" class="java.util.Date" isForPrompting="false"/>
	<queryString>
		<![CDATA[SELECT DISTINCT ON (c.entity_id, c.proj_id , c.pbl_id, c.seq_no)
FALSE, a.projcode as proj_id ,b.unit_id as unit_id, a.seq_no as seq_no,
TRIM(b.phase) as phase, TRIM(b.block) as block, TRIM(b.lot) as lot,
a.entity_id, get_client_name(a.entity_id) as client_name,
get_nsp(a.entity_id, a.pbl_id, a.seq_no, a.projcode) as nsp,
get_loan_availed(a.entity_id, a.pbl_id, a.seq_no, a.projcode) as loan_availed,
get_ob(a.entity_id, a.projcode, a.pbl_id, a.seq_no) as ob,
count(c.scheddate)::INT as terms, get_bank_int_rate(count(c.scheddate)::INT, $P{bank_id}) as int_rate--PUT HERE PARAMETER BANK_ID
FROM rf_sold_unit a
LEFT JOIN mf_unit_info b on b.proj_id = a.projcode and b.pbl_id = a.pbl_id
LEFT JOIN rf_client_schedule c on c.entity_id = a.entity_id and c.proj_id = a.projcode and c.pbl_id = a.pbl_id and c.seq_no = a.seq_no
WHERE get_group_id(a.buyertype) = '02'
AND EXISTS (SELECT *
	    FROM rf_buyer_status
	    WHERE entity_id = a.entity_id
	    AND proj_id = a.projcode
	    AND pbl_id = a.pbl_id
	    AND byrstatus_id = '19'
	    AND tran_date <= $P{cut_off_date} --REPLACE WITH PARAMETER CUT OFF DATE
	    AND status_id = 'A')
AND EXISTS (SELECT *
	    FROM rf_client_ledger
	    WHERE entity_id = a.entity_id
	    AND proj_id = a.projcode
	    AND pbl_id = a.pbl_id
	    AND seq_no = a.seq_no
	    AND part_id = '013'
	    AND balance = 0
	    AND date_posted <= $P{cut_off_date} --REPLACE WITH PARAMETER CUT OFF DATE
	    AND status_id = 'A')
AND c.part_id = '014'
AND c.status_id = 'A'
AND c.scheddate > $P{cut_off_date} --REPLACE WITH PARAMETER CUT OFF DATE
AND a.projcode = $P{proj_id} --(CASE WHEN TRUE THEN a.projcode = '015' ELSE TRUE END)
AND b.sub_proj_id = $P{sub_proj_id} --(CASE WHEN TRUE THEN b.sub_proj_id = '001' ELSE TRUE END)
GROUP by b.unit_id, a.seq_no, b.phase, b.block, b.lot, a.entity_id,
a.pbl_id, a.projcode, c.entity_id, c.proj_id, c.pbl_id, c.seq_no;]]>
	</queryString>
	<field name="bool" class="java.lang.Boolean"/>
	<field name="proj_id" class="java.lang.String"/>
	<field name="unit_id" class="java.lang.String"/>
	<field name="seq_no" class="java.lang.Integer"/>
	<field name="phase" class="java.lang.String"/>
	<field name="block" class="java.lang.String"/>
	<field name="lot" class="java.lang.String"/>
	<field name="entity_id" class="java.lang.String"/>
	<field name="client_name" class="java.lang.String"/>
	<field name="nsp" class="java.math.BigDecimal"/>
	<field name="loan_availed" class="java.math.BigDecimal"/>
	<field name="ob" class="java.math.BigDecimal"/>
	<field name="terms" class="java.lang.Integer"/>
	<field name="int_rate" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="68" splitType="Stretch">
			<staticText>
				<reportElement x="1" y="30" width="173" height="20"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="true"/>
				</textElement>
				<text><![CDATA[List of SOR Qualified Accounts]]></text>
			</staticText>
			<textField pattern="MMMMM dd, yyyy">
				<reportElement x="1" y="48" width="151" height="20"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<columnHeader>
		<band height="27" splitType="Stretch">
			<line>
				<reportElement x="0" y="3" width="572" height="1"/>
			</line>
			<staticText>
				<reportElement x="1" y="4" width="66" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[Project]]></text>
			</staticText>
			<staticText>
				<reportElement x="67" y="4" width="69" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[Unit ID]]></text>
			</staticText>
			<staticText>
				<reportElement x="136" y="4" width="183" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[Client Name]]></text>
			</staticText>
			<staticText>
				<reportElement x="319" y="4" width="72" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[NSP]]></text>
			</staticText>
			<staticText>
				<reportElement x="391" y="4" width="89" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[Sold Amount]]></text>
			</staticText>
			<staticText>
				<reportElement x="480" y="4" width="41" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[Terms]]></text>
			</staticText>
			<staticText>
				<reportElement x="521" y="4" width="50" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" isBold="false"/>
				</textElement>
				<text><![CDATA[Interest]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="24" width="572" height="1"/>
			</line>
		</band>
	</columnHeader>
	<detail>
		<band height="22" splitType="Stretch">
			<textField>
				<reportElement x="0" y="1" width="67" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{proj_id}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="67" y="1" width="69" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{unit_id}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="136" y="1" width="183" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{client_name}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="319" y="1" width="72" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{nsp}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="391" y="0" width="89" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{loan_availed}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="521" y="0" width="50" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{int_rate}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0.00">
				<reportElement x="480" y="0" width="41" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$F{terms}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="27" splitType="Stretch">
			<textField>
				<reportElement x="450" y="3" width="80" height="20"/>
				<textElement textAlignment="Right" verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Page "+$V{PAGE_NUMBER}+" of"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="530" y="3" width="40" height="20"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Tahoma"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
</jasperReport>
