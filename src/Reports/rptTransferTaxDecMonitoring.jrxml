<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="rptTransferTaxDecMonitoring" pageWidth="792" pageHeight="612" orientation="Landscape" columnWidth="752" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.5"/>
	<property name="ireport.x" value="15"/>
	<property name="ireport.y" value="26"/>
	<parameter name="Company" class="java.lang.String"/>
	<parameter name="Project" class="java.lang.String"/>
	<parameter name="Year" class="java.lang.String"/>
	<queryString>
		<![CDATA[select e.entity_name,
d.proj_alias,
a.pbl_id,
a.seq_no,
c.phase,
c.block,
c.lot,
b.actual_date as returned_date,
f.doc_no as td_lot,
g.doc_no as td_house,
(SELECT y.status_desc
	FROM rf_tct_taxdec_monitoring_dl x
	LEFT JOIN mf_tct_taxdec_status y on TRIM(x.doc_status) = y.status_code
	where TRIM(x.pbl_id) = a.pbl_id
	and TRIM(x.doc_no) = f.doc_no
	and TRIM(x.status_id) = 'A'
	and y.status_type = 'L'
 	and y.status_id = 'A'
	order by x.date_created desc limit 1) as td_lot_loc,
(SELECT y.status_desc
	FROM rf_tct_taxdec_monitoring_dl x
	LEFT JOIN mf_tct_taxdec_status y on TRIM(x.doc_status) = y.status_code
	where TRIM(x.pbl_id) = a.pbl_id
	and TRIM(x.doc_no) = g.doc_no
	and TRIM(x.status_id) = 'A'
	and y.status_type = 'L'
 	and y.status_id = 'A'
	order by x.date_created desc limit 1) as td_house_loc,
d.proj_name
from rf_sold_unit a
left join rf_buyer_status b on a.projcode = b.proj_id and a.pbl_id = b.pbl_id and a.seq_no = b.seq_no and b.status_id = 'A'
left join mf_unit_info c on a.projcode = c.proj_id and a.pbl_id = c.pbl_id
left join mf_project d on a.projcode = d.proj_id and d.status_id = 'A'
left join rf_entity e on a.entity_id = e.entity_id
left join rf_tct_taxdec_monitoring_hd f on a.pbl_id = f.pbl_id and a.projcode = f.projcode and f.doc_type = '67' and f.status_id = 'A'
left join rf_tct_taxdec_monitoring_hd g on a.pbl_id = g.pbl_id and a.projcode = g.projcode and g.doc_type = '98' and g.status_id = 'A'
--left join rf_tct_taxdec_monitoring_dl h on f.pbl_id = h.pbl_id and f.doc_no = h.doc_no  and h.status_id = 'A'
where a.status_id = 'A'
and a.projcode = $P{Project}
and b.byrstatus_id in ('73')
and not exists ( select * from rf_buyer_status where entity_id = a.entity_id and proj_id = a.projcode and pbl_id = a.pbl_id and seq_no = a.seq_no   and byrstatus_id = '78')
and exists (select * from rf_buyer_status where entity_id = a.entity_id and proj_id = a.projcode and pbl_id = a.pbl_id and seq_no = a.seq_no  and byrstatus_id in('89','139'))
and date_part('year', b.actual_date::date)::varchar = $P{Year}
order by b.actual_date asc]]>
	</queryString>
	<field name="entity_name" class="java.lang.String"/>
	<field name="proj_alias" class="java.lang.String"/>
	<field name="pbl_id" class="java.lang.String"/>
	<field name="seq_no" class="java.lang.Integer"/>
	<field name="phase" class="java.lang.String"/>
	<field name="block" class="java.lang.String"/>
	<field name="lot" class="java.lang.String"/>
	<field name="returned_date" class="java.sql.Timestamp"/>
	<field name="td_lot" class="java.lang.String"/>
	<field name="td_house" class="java.lang.String"/>
	<field name="td_lot_loc" class="java.lang.String"/>
	<field name="td_house_loc" class="java.lang.String"/>
	<field name="proj_name" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="112">
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="0" width="430" height="40"/>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="14" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{Company}]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yy" isBlankWhenNull="true">
				<reportElement x="0" y="40" width="352" height="32"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["TRANSFER TAX DEC MONITORING"]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yy" isBlankWhenNull="true">
				<reportElement x="0" y="72" width="236" height="14"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Project : " + $F{proj_name}]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yy" isBlankWhenNull="true">
				<reportElement x="0" y="86" width="236" height="14"/>
				<box>
					<pen lineWidth="0.0"/>
					<topPen lineWidth="0.0"/>
					<leftPen lineWidth="0.0"/>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="10" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Year : " + $P{Year}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="36" splitType="Stretch">
			<staticText>
				<reportElement mode="Transparent" x="246" y="1" width="42" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[LOT]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="179" y="1" width="29" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[PH]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="208" y="1" width="38" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[BLK]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="288" y="0" width="138" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false"/>
				</textElement>
				<text><![CDATA[TCT RETURNED TO DEVELOPER]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="130" y="1" width="49" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[PROJ]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="0" y="1" width="130" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[CLIENT NAME]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="426" y="1" width="70" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[TD LOT]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="586" y="0" width="78" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[TD HOUSE]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="496" y="1" width="90" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[DOC LOCATION]]></text>
			</staticText>
			<staticText>
				<reportElement mode="Transparent" x="664" y="1" width="88" height="35"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[DOC LOCATION]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement x="179" y="0" width="29" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{phase}]]></textFieldExpression>
			</textField>
			<textField pattern="MM/dd/yyyy">
				<reportElement x="288" y="0" width="138" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.util.Date"><![CDATA[$F{returned_date}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="130" y="0" width="49" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{proj_alias}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="246" y="0" width="42" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{lot}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="130" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{entity_name}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="208" y="0" width="38" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{block}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="664" y="0" width="88" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{td_house_loc}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="496" y="0" width="90" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{td_lot_loc}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="426" y="0" width="70" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{td_lot}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="586" y="0" width="78" height="20"/>
				<box>
					<pen lineWidth="0.05"/>
					<topPen lineWidth="0.05" lineStyle="Solid"/>
					<leftPen lineWidth="0.05" lineStyle="Solid"/>
					<bottomPen lineWidth="0.05" lineStyle="Solid"/>
					<rightPen lineWidth="0.05" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{td_house}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
